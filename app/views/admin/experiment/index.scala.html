@(experimentList: List[MAExperiment], user: MAUser, errorMsg: String,
	experiment: MAExperiment)

@admin.main(experimentList, user){

<header>
	<hgroup>
		<h2>/ > </h2>
		<h3>@experiment.getId() @experiment.getTitle() > </h3>
	</hgroup>
</header>

<article class="tasks" id="tasks">
	@if(errorMsg != null) {
		<p class="error">@errorMsg</p>
	}

	@for(member <- experiment.getMemberList()) {
		<p class="owner"> @member.getName() (@member.getEmail())</p>
	}
	<input id="newGroup" type="button" onClick="tryExperiment()"
		value="Try">
	<input id="newGroup" type="button" onClick="addComponent()"
		value="Add Component">
	<input id="newGroup" type="button" onClick="updateExperiment()"
		value="Update">
	<input id="newGroup" type="button" onClick="updateMembers()"
		value="Update Members">
	<input id="newGroup" type="button" onClick="showMTurkSourceCode()"
		value="MT Source Code">
	<input id="newGroup" type="button" onClick="removeExperiment()"
		value="Remove">
	<div class="folder" data-folder-id="@experiment.getId()">
		<header>
			@if(experiment.getComponentList().isEmpty()) {
				<h3>No components so far</h3>
			} else {
				<h3>Components so far</h3>
			}
		</header>

		<ul class="list" id="componentList">
			@for(component <- experiment.getComponentList()) {
				<li component-id="@component.getId()">
					<p class="upArrow" component-id="@component.getId()">&#9650;</p>
					<p class="downArrow" component-id="@component.getId()">&#9660;</p>
					<a class="name"
							href="@routes.Components.index(experiment.getId(), component.getId())">
							@component.getId() @component.getTitle() (@component.getResultList().size())
					</a>
				</li>
			}
		</ul>
	</div>
</article>

<script type="text/javascript">

	$(".upArrow").click(function(e) {
		var componentElement = $(e.target);
		var componentId = componentElement.attr("component-id");
		ajaxChangeComponentOrder(componentId, "up", componentElement);
	});
	
	$(".downArrow").click(function(e) {
		var componentElement = $(e.target);
		var componentId = componentElement.attr("component-id");
		ajaxChangeComponentOrder(componentId, "down", componentElement);
	});
	
	function ajaxChangeComponentOrder(componentId, direction, componentElement) {
		var ajax = $.ajax({
			url: "/admin/@experiment.getId()/changeComponentOrder"
				+ "?componentId=" + componentId + "&direction=" + direction,
			type: "POST",
			success: function(response) {
				if (direction == "up") {
					componentElement.parent()
						.insertBefore(componentElement.parent().prev());
				}
				if (direction == "down") {
					componentElement.parent()
						.insertAfter(componentElement.parent().next());
				}
			},
			error: function(err) {
				alert(err.responseText);
			}
		});
	}
	
	function tryExperiment() {
		window.location.href = "@routes.Publix.startExperiment(experiment.getId())";
	}

	function addComponent() {
		window.location.href = "@routes.Components.create(experiment.getId())";
	}

	function updateExperiment() {
		window.location.href = "@routes.Experiments.update(experiment.getId())";
	}
	
	function updateMembers() {
		window.location.href = "@routes.Experiments.updateMembers(experiment.getId())";
	}
	
	function showMTurkSourceCode() {
		window.location.href = "@routes.Experiments.showMTurkSourceCode(experiment.getId())";
	}

	function removeExperiment() {
		var conf = confirm("Are you sure you want to remove experiment "
				+ "@experiment.getId()" + "\u00a0" + "\"@Html(experiment.getTitle())\"?");
		if (conf == true) {
			$.ajax({
				url : '@routes.Experiments.remove(experiment.getId())',
				type : 'DELETE',
				success : function(result) {
					window.location.replace('@routes.Admin.index()');
				},
				error : function(err) {
					alert(err.responseText);
				}
			});
		}
	}
</script>

}
