@(studyList: List[MAStudy], loggedInUser: MAUser, breadcrumbs: String,
	errorMsg: String, study: MAStudy)

@admin.main(studyList, loggedInUser, breadcrumbs){

<article class="study">
	@if(errorMsg != null) {
		<p class="error">@errorMsg</p>
	}
	
	<div class="boxRow">
		<div class="studyBox">
			<header>
				<h3>Study</h3>
				<div class="placeHolder">X</div>
			</header>
			<div class="tryStudy">Show Whole Study</div>	
			<div class="updateStudy">Properties</div>
			<div class="showMTurkSourceCode">MT Source Code</div>
			<div class="removeStudy">Remove</div>
		</div>
	
		<div class="membersBox">
			<header>
				<h3>Members</h3>
				<div class="updateMembers">Change Members</div>
			</header>
			<ul>
				@for(member <- study.getMemberList()) {
					<li>
						<a class="member" href="@routes.Users.profile(member.getEmail())"> @member.getName() (@member.getEmail())</a>
					</li>
				}
			</ul>
		</div>
	</div>
	
	<div class="componentsBox">
		<header>
			<h3>Components</h3>
			<div class="addComponent">+</div>
		</header>

		<ul>
			@for(component <- study.getComponentList()) {
				<li component-id="@component.getId()">
					<div class="arrows">
						<div class="upArrow" component-id="@component.getId()"><p>&#9650;</p></div>
						<div class="downArrow" component-id="@component.getId()"><p>&#9660;</p></div>
					</div>
					<a class="name"
							href="@routes.Components.index(study.getId(), component.getId())">
							@component.getTitle() (id: @component.getId())
					</a>
					<div class="tryComponent">Show From Here</div>
					<div class="showResults">Show Results (@component.getResultList().size())</div>
					<div class="removeComponent">Remove</div>
				</li>
			}
		</ul>
	</div>
	
</article>

<script type="text/javascript">

	$(".upArrow").click(function(e) {
		var componentElement = $(e.target).parent();
		var componentId = componentElement.attr("component-id");
		ajaxChangeComponentOrder(componentId, "up", componentElement);
	});
	
	$(".downArrow").click(function(e) {
		var componentElement = $(e.target).parent();
		var componentId = componentElement.attr("component-id");
		ajaxChangeComponentOrder(componentId, "down", componentElement);
	});
	
	function ajaxChangeComponentOrder(componentId, direction, componentElement) {
		var ajax = $.ajax({
			url: "/admin/@study.getId()/changeComponentOrder"
				+ "?componentId=" + componentId + "&direction=" + direction,
			type: "POST",
			success: function(response) {
				var liElement = componentElement.parent().parent();
				if (direction == "up") {
					liElement.insertBefore(liElement.prev());
				}
				if (direction == "down") {
					liElement.insertAfter(liElement.next());
				}
			},
			error: function(err) {
				alert(err.responseText);
			}
		});
	}
	
	$(".tryStudy").click(function(e) {
		window.location.href = "@routes.Publix.startStudy(study.getId())";
	});

	$(".updateStudy").click(function(e) {
		window.location.href = "@routes.Studies.properties(study.getId())";
	});
	
	$(".updateMembers").click(function(e) {
		window.location.href = "@routes.Studies.changeMembers(study.getId())";
	});
	
	$(".showMTurkSourceCode").click(function(e) {
		window.location.href = "@routes.Studies.showMTurkSourceCode(study.getId())";
	});
	
	$(".removeStudy").click(function(e) {
		var conf = confirm("Are you sure you want to remove study "
				+ "@study.getId()" + "\u00a0" + "\"@Html(study.getTitle())\"?");
		if (conf == true) {
			$.ajax({
				url : '@routes.Studies.remove(study.getId())',
				type : 'DELETE',
				success : function(result) {
					window.location.replace('@routes.Admin.dashboard()');
				},
				error : function(err) {
					alert(err.responseText);
				}
			});
		}
	});
	
	$(".addComponent").click(function(e) {
		window.location.href = "/admin/@study.getId/createComponent";
	});
	
	$(".tryComponent").click(function(e) {
		var componentId = getComponentId(e);
		window.location.href = "/admin/@study.getId/"+ componentId + "/try";
	});
	
	$(".showResults").click(function(e) {
		var componentId = getComponentId(e);
		window.location.href = "/admin/@study.getId/"+ componentId + "/";
	});
	
	$(".removeComponent").click(function(e) {
		var componentId = getComponentId(e);
		var conf = confirm("Are you sure you want to remove component "
				+ componentId + "?");
		if (conf == true) {
			$.ajax({
				url : window.location.href = "/admin/@study.getId/"+ componentId + "/remove",
				type : 'DELETE',
				success : function(result) {
					window.location.replace('@routes.Admin.dashboard()');
				},
				error : function(err) {
					alert(err.responseText);
				}
			});
		}
	});
	
	function getComponentId(e) {
		var componentElement = $(e.target).parent();
		var componentId = componentElement.attr("component-id");
		return componentId;
	}
	
</script>

}
