var jatos={};!function(){"use strict";jatos.version="3.7.3",jatos.httpTimeout=3e4,jatos.httpRetry=5,jatos.httpRetryWait=1e3,jatos.studyJsonInput={},jatos.studyLength=null,jatos.studyProperties={},jatos.studySessionData={},jatos.componentList=[],jatos.componentJsonInput={},jatos.componentPos=null,jatos.componentProperties={},jatos.batchProperties={},jatos.batchJsonInput={},jatos.groupMemberId=null,jatos.groupResultId=null,jatos.groupMembers=[],jatos.groupChannels=[];var t={},e={};jatos.channelSendingTimeoutTime=1e4,jatos.channelHeartbeatInterval=25e3,jatos.channelHeartbeatTimeoutTime=1e4,jatos.channelClosedCheckInterval=2e3,jatos.channelOpeningBackoffTimeMin=1e3,jatos.channelOpeningBackoffTimeMax=12e4,jatos.waitSendDataOverlayConfig={text:"Sending data. Please wait."};var o,n,a,s,r,i,u,c,l,p,d={},j={},f=[],m=[],y=0,h=0;jatos.batchSessionVersioning=!0,jatos.groupSessionVersioning=!0;var g,v,b,S,w,I,O,T,x,E,C,P,D="WebSocket"in window,R=0,L={},N=!1,A=!1,k=!1,M=!1,Q=new Event("jatosOnLoad"),J=!0;function U(t,e,o){if(!N)return jatos.jQuery.Deferred().reject();var n=jatos.jQuery.Deferred();n.done((function(){st(e)})),n.fail((function(t){it(o,t)}));var a=R++;return t.id=a,L[t.id]=n,ct(E)||(E=jatos.jQuery.Deferred()),v.postMessage(t),n}function W(t){var e={};return t.forEach((function(t){var o=t.split("="),n=decodeURIComponent(o[1]);e[o[0]]=n})),e}function B(){return jatos.jQuery.ajax({url:nt("initData"),type:"GET",dataType:"json",timeout:jatos.httpTimeout,success:G,error:function(t){it(null,rt(t))}}).retry({times:jatos.httpRetry,timeout:jatos.httpRetryWait})}function G(t){jatos.batchProperties=t.batchProperties,void 0!==jatos.batchProperties.jsonData?jatos.batchJsonInput=jatos.jQuery.parseJSON(jatos.batchProperties.jsonData):jatos.batchJsonInput={},delete jatos.batchProperties.jsonData;try{jatos.studySessionData=JSON.parse(t.studySessionData)}catch(t){it(null,t.stack||t)}jatos.studyProperties=t.studyProperties,void 0!==jatos.studyProperties.jsonData&&null!==jatos.studyProperties.jsonData?jatos.studyJsonInput=jatos.jQuery.parseJSON(jatos.studyProperties.jsonData):jatos.studyJsonInput={},delete jatos.studyProperties.jsonData,jatos.componentList=t.componentList,jatos.studyLength=t.componentList.length,jatos.componentProperties=t.componentProperties,void 0!==jatos.componentProperties.jsonData&&null!==jatos.componentProperties.jsonData?jatos.componentJsonInput=jatos.jQuery.parseJSON(jatos.componentProperties.jsonData):jatos.componentJsonInput={},delete jatos.componentProperties.jsonData,jatos.urlQueryParameters=t.urlQueryParameters,jatos.studyCode=t.studyCode}function V(){!A&&N&&(A=!0,window.dispatchEvent(Q))}function F(t){return"number"!=typeof t&&(t=jatos.channelOpeningBackoffTimeMin),function(){if(!D)return it(null,"This browser does not support WebSockets. Can't open batch channel."),lt();if(c&&c.readyState!=c.CLOSED)return lt();if(ct(b))return it(null,"Can open only one batch channel."),lt();return b=jatos.jQuery.Deferred(),(c=new WebSocket(("https:"===window.location.protocol?"wss://":"ws://")+window.location.host+jatos.urlBasePath+"publix/"+jatos.studyResultUuid+"/batch/open")).onopen=function(){clearInterval(n),n=setInterval((function(){if(c.readyState==c.OPEN){c.send('{"heartbeat":"ping"}');var t=setTimeout((function(){it(null,"Batch channel heartbeat fail"),H()}),jatos.channelHeartbeatTimeoutTime);f.push(t)}}),jatos.channelHeartbeatInterval),clearInterval(s),s=setInterval((function(){c.readyState==c.CLOSED&&(it(null,"Batch channel closed unexpectedly"),clearInterval(s),H())}),jatos.channelClosedCheckInterval)},c.onmessage=function(t){!function(t){var o;try{o=JSON.parse(t)}catch(t){return void it(null,t)}if(void 0!==o.heartbeat)return void q();void 0!==o.patches&&("remove"==o.patches[0].op&&"/"==o.patches[0].path?e={}:jsonpatch.apply(e,o.patches));void 0!==o.data&&(e=null===o.data?{}:o.data);void 0!==o.version?(i=o.version,b.resolve()):(it(null,"Batch channel opening failed: version missing"),b.reject());void 0!==o.action&&function(t){switch(t.action){case"SESSION":t.patches.forEach((function(t){st(C,t.path,t.op)}));break;case"SESSION_ACK":d.hasOwnProperty(t.id)?d[t.id].cancel():it(null,"Batch session got 'SESSION_ACK' with nonexistent ID "+t.id);break;case"SESSION_FAIL":d.hasOwnProperty(t.id)?d[t.id].trigger():it(null,"Batch session got 'SESSION_FAIL' with nonexistent ID "+t.id);break;case"ERROR":it(null,t.errorMsg);break}}(o)}(t.data)},c.onerror=function(){it(null,"Batch channel error"),b.reject()},c.onclose=function(){_(),b.reject()},b.promise()}().fail((function(){t<jatos.channelOpeningBackoffTimeMax&&(t*=2),setTimeout((function(){F(t)}),t)}))}function H(){ct(b)||(c instanceof WebSocket&&c.close(),_(),F())}function _(){e={},i=null,q(),clearInterval(n)}function q(){f.forEach((function(t){clearTimeout(t)})),f=[]}function z(t,e,o,n){var a={};return a.op=t,null!==e&&(a.path=e),null!==o&&(a.value=o),null!==n&&(a.from=n),a}function K(t,e,o){if(!c||c.readyState!=c.OPEN)return it(o,"No open batch channel"),lt();if(jatos.batchSessionVersioning&&ct(S))return it(o,"Can send only one batch session patch at a time"),lt();var n=jatos.jQuery.Deferred();jatos.batchSessionVersioning&&(S=n);var a=y++,s={action:"SESSION"};s.id=a,s.patches=t.constructor===Array?t:[t],s.version=i,s.versioning=!!jatos.batchSessionVersioning;try{c.send(JSON.stringify(s)),ut(n,d,a,e,o)}catch(t){it(o,t),n.reject()}return n.promise()}function X(t,e,o,n){var a=e?"POST":"PUT";return t===Object(t)&&(t=JSON.stringify(t)),U({url:nt("resultData"),data:t,method:a,contentType:"text/plain; charset=UTF-8",timeout:jatos.httpTimeout,retry:jatos.httpRetry,retryWait:jatos.httpRetryWait},o,n).promise()}function Y(){return D?l&&l.readyState!=l.CLOSED?lt():ct(w)?(it(p.onError,"Can open group channel only once"),lt()):ct(x)?(it(p.onError,"Can't open group channel while leaving a group"),lt()):ct(T)?(it(p.onError,"Can't open group channel while reassigning a group"),lt()):(w=jatos.jQuery.Deferred(),(l=new WebSocket(("https:"===window.location.protocol?"wss://":"ws://")+window.location.host+jatos.urlBasePath+"publix/"+jatos.studyResultUuid+"/group/join")).onopen=function(){clearInterval(a),a=setInterval((function(){if(l.readyState==l.OPEN){l.send('{"heartbeat":"ping"}');var t=setTimeout((function(){it(p.onError,"Group channel heartbeat fail"),$()}),jatos.channelHeartbeatTimeoutTime);m.push(t)}}),jatos.channelHeartbeatInterval),clearInterval(r),r=setInterval((function(){l.readyState==l.CLOSED&&(it(p.onError,"Group channel closed unexpectedly"),clearInterval(r),$())}),jatos.channelClosedCheckInterval)},l.onmessage=function(e){!function(e){var n;try{n=JSON.parse(e)}catch(t){return void it(p.onError,t)}if(void 0!==n.heartbeat)return void tt();(function(e){void 0!==e.groupResultId&&(jatos.groupResultId=e.groupResultId.toString(),jatos.groupMemberId=jatos.studyResultId);void 0!==e.members&&(jatos.groupMembers=e.members);void 0!==e.channels&&(jatos.groupChannels=e.channels);void 0!==e.sessionPatches&&("remove"==e.sessionPatches[0].op&&"/"==e.sessionPatches[0].path?t={}:jsonpatch.apply(t,e.sessionPatches));void 0!==e.sessionData&&(t=null===e.sessionData?{}:e.sessionData);void 0!==e.sessionVersion?(u=e.sessionVersion,w.resolve()):(it(null,"Group channel opening failed: version missing"),w.reject())})(n),function(t){if(!t.action)return;switch(t.action){case"OPENED":t.memberId==jatos.groupMemberId?st(p.onOpen,t.memberId):(st(p.onMemberOpen,t.memberId),st(p.onUpdate));break;case"CLOSED":t.memberId!=jatos.groupMemberId&&(st(p.onMemberClose,t.memberId),st(p.onUpdate));break;case"JOINED":t.memberId!=jatos.groupMemberId&&(st(p.onMemberJoin,t.memberId),st(p.onUpdate));break;case"LEFT":t.memberId!=jatos.groupMemberId&&(st(p.onMemberLeave,t.memberId),st(p.onUpdate));break;case"SESSION":t.sessionPatches.forEach((function(t){st(p.onGroupSession,t.path,t.op)})),st(p.onUpdate);break;case"FIXED":o&&o.cancel(),st(p.onUpdate);break;case"SESSION_ACK":j.hasOwnProperty(t.sessionActionId)?j[t.sessionActionId].cancel():it(null,"Group session got 'SESSION_ACK' with nonexistent ID "+t.sessionActionId);break;case"SESSION_FAIL":j.hasOwnProperty(t.sessionActionId)?j[t.sessionActionId].trigger():it(null,"Group session got 'SESSION_FAIL' with nonexistent ID "+t.sessionActionId);break;case"ERROR":it(p.onError,t.errorMsg);break}}(n),n.msg&&p.onMessage&&p.onMessage(n.msg)}(e.data)},l.onerror=function(){it(p.onError,"Group channel error"),w.reject()},l.onclose=function(){et(),st(p.onClose),w.reject()},w.promise()):(it(p.onError,"This browser does not support WebSockets."),lt())}function Z(t){"number"!=typeof t&&(t=jatos.channelOpeningBackoffTimeMin),Y().fail((function(){t<jatos.channelOpeningBackoffTimeMax&&(t*=2),setTimeout((function(){Z(t)}),t)}))}function $(){ct(w)||ct(T)||ct(x)||(l&&l.readyState!=l.CLOSED&&l.close(),et(),Z())}function tt(){m.forEach((function(t){clearTimeout(t)})),m=[]}function et(){jatos.groupMemberId=null,jatos.groupResultId=null,jatos.groupMembers=[],jatos.groupChannels=[],t={},u=null,tt(),clearInterval(a)}function ot(t,e,o){if(!l||l.readyState!=l.OPEN)return it(o,"No open group channel"),lt();if(jatos.groupSessionVersioning&&ct(I))return it(o,"Can send only one group session patch at a time"),lt();var n=jatos.jQuery.Deferred();jatos.groupSessionVersioning&&(I=n);var a=h++,s={action:"SESSION"};s.sessionActionId=a,s.sessionPatches=t.constructor===Array?t:[t],s.sessionVersion=u,s.sessionVersioning=!!jatos.groupSessionVersioning;try{l.send(JSON.stringify(s)),ut(n,j,a,e,o)}catch(t){it(o,t),n.reject()}return n.promise()}function nt(t){return new URL(t,window.location.href).toString()}jatos.jQuery={},function(t,e){var o=document.createElement("script");o.src=t;var n=document.getElementsByTagName("head")[0],a=!1;o.onload=o.onreadystatechange=function(){a||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(a=!0,e(),o.onload=o.onreadystatechange=null,n.removeChild(o))},n.appendChild(o)}("jatos-publix/javascripts/jquery-3.5.1.min.js",(function(){jatos.jQuery=jQuery.noConflict(!0),jatos.jQuery.ajaxSetup({cache:!0}),jatos.jQuery.when(jatos.jQuery.getScript("jatos-publix/javascripts/jquery.ajax-retry.min.js"),jatos.jQuery.getScript("jatos-publix/javascripts/json-patch-duplex.min.js"),jatos.jQuery.getScript("jatos-publix/javascripts/jsonpointer.min.js")).then((function(){jatos.studyResultUuid=window.location.pathname.split("/").reverse()[2],function(){for(var t="JATOS_IDS",e=document.cookie.split(";"),o=function(t,e){jatos[t]=e},n=0;n<e.length;n++){for(var a=e[n];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t)){var s=W(a.substr(a.indexOf(t)+t.length+3,a.length).split("&"));if(s.studyResultUuid==jatos.studyResultUuid){jatos.jQuery.each(s,o),jatos.componentPos=parseInt(jatos.componentPos);break}}}}(),(g=new Worker("jatos-publix/javascripts/heartbeat.js")).postMessage([jatos.studyResultUuid]),(v=new Worker("jatos-publix/javascripts/httpLoop.js")).addEventListener("message",(function(t){!function(t){var e=L[t.requestId];if(delete L[t.requestId],200==t.status)e.resolve();else{var o=[t.status,t.statusText,t.error].filter((function(t){return t})).join(", ");e.reject(t.method+" to "+t.url+" failed: "+o)}0===Object.keys(L).length&&ct(E)&&E.resolve()}(t.data)}),!1)})).then(B).then(F).always((function(){N=!0,V()}))})),jatos.onLoad=function(t){A?t():(window.addEventListener("jatosOnLoad",t),V())},jatos.onload=jatos.onLoad,jatos.batchSession={},jatos.batchSession.get=function(t){return dt(jsonpointer.get(e,"/"+t))},jatos.batchSession.getAll=function(){return dt(jatos.batchSession.find(""))},jatos.batchSession.find=function(t){return dt(jsonpointer.get(e,t))},jatos.batchSession.test=function(t,o){return jsonpointer.get(e,t)===o},jatos.batchSession.defined=function(t){return!jatos.batchSession.test(t,void 0)},jatos.batchSession.add=function(t,e,o,n){return K(z("add",t,e,null),o,n)},jatos.batchSession.set=function(t,e,o,n){return K(z("add","/"+t,e,null),o,n)},jatos.batchSession.setAll=function(t,e,o){return jatos.batchSession.replace("",t,e,o)},jatos.batchSession.remove=function(t,e,o){return K(z("remove",t,null,null),e,o)},jatos.batchSession.clear=function(t,e){return K(z("remove","/",null,null),t,e)},jatos.batchSession.replace=function(t,e,o,n){return K(z("replace",t,e,null),o,n)},jatos.batchSession.copy=function(t,e,o,n){return K(z("copy",e,null,t),o,n)},jatos.batchSession.move=function(t,e,o,n){return K(z("move",e,null,t),o,n)},jatos.setHeartbeatPeriod=function(t){"number"==typeof t&&g&&g.postMessage([jatos.studyResultUuid,t])},jatos.onBatchSession=function(t){C=t},jatos.onError=function(t){P=t},jatos.submitResultData=function(t,e,o){return X(t,!1,e,o)},jatos.appendResultData=function(t,e,o){return X(t,!0,e,o)},jatos.uploadResultFile=function(t,e,o,n){if("string"!=typeof e||0===e.length)return it(n,"No filename specified"),lt();var a;if(t instanceof Blob)a=t;else if("string"==typeof t)a=new Blob([t],{type:"text/plain"});else{if(t!==Object(t))return it(n,"Only string, Object or Blob allowed"),lt();a=new Blob([JSON.stringify(t,null,2)],{type:"application/json"})}return U({url:nt("files/"+encodeURI(e)),blob:a,filename:e,method:"POST",timeout:jatos.httpTimeout,retry:jatos.httpRetry,retryWait:jatos.httpRetryWait},o,n).promise()},jatos.downloadResultFile=function(t,e,o,n){if(!N)return lt();var a,s,r,i;if("number"==typeof t)a=t,s=e,r=o,i=n;else{if("string"!=typeof t)return it(i,"Unknown first parameter"),lt();s=t,r=e,i=o}if("string"!=typeof s||0===s.length)return it(i,"No filename specified"),lt();var u=nt("../files/"+encodeURI(s));if(a){if(pt(a))return it(i,"Component position does not exist"),lt();u+="?componentId="+jatos.componentList[a-1].id}var c=jatos.jQuery.Deferred(),l=new XMLHttpRequest;return l.open("GET",u,!0),l.responseType="blob",l.onload=function(){if(200==this.status){var t=l.response;if("application/json"==t.type){var e=new FileReader;e.addEventListener("loadend",(function(){var t=JSON.parse(e.result);st(r,t),c.resolve(t)})),e.readAsText(t)}else if("text/plain"==t.type){var o=new FileReader;o.addEventListener("loadend",(function(){var t=o.result;st(r,t),c.resolve(t)})),o.readAsText(t)}else st(r,t),c.resolve(t)}else l.onerror()},l.onerror=function(){var t="Download of "+s+" returned "+l.statusText;it(i,t),c.reject(t)},l.send(null),c.promise()},jatos.setStudySessionData=function(t,e,o){jatos.studySessionData=t;var n=JSON.stringify(t);return U({url:nt("../studySessionData"),data:n,method:"POST",contentType:"text/plain; charset=UTF-8",timeout:jatos.httpTimeout,retry:jatos.httpRetry,retryWait:jatos.httpRetryWait},e,o).promise()},jatos.startComponent=function(t,e,o,n){var a,s,r;if(N)if(r="number"==typeof t?jatos.componentList.find((e=>e.id==t)).uuid:t,"string"==typeof o?(a=o,s=n):"function"==typeof o&&(s=o),k)it(s,"Can start only one component at the same time");else{k=!0,e&&jatos.appendResultData(e),jatos.setStudySessionData(jatos.studySessionData);var i=function(){window.removeEventListener("beforeunload",at,{capture:!0});var t=nt("../"+r+"/start");a&&(t=t+"?"+jatos.jQuery.param({message:a})),window.location.href=t};ct(E)?(setTimeout(jatos.showOverlay,1e3,jatos.waitSendDataOverlayConfig),E.always(i)):i()}},jatos.startComponentByPos=function(t,e,o,n){var a;if(pt(t))return"function"==typeof o?a=o:"function"==typeof n&&(a=n),void it(a,"Component position does not exist");var s=jatos.componentList[t-1].uuid;jatos.startComponent(s,e,o,n)},jatos.startNextComponent=function(t,e,o){var n,a;"string"==typeof e?(n=e,a=o):a=e;var s=jatos.componentList.slice().reverse().find((function(t){return t.active}));if(jatos.componentPos>=s.position)if(t){jatos.appendResultData(t).done((function(){jatos.endStudy(!0,n)})).fail(a)}else jatos.endStudy(!0,n);else for(var r=jatos.componentPos;r<jatos.componentList.length;r++)if(jatos.componentList[r].active){var i=jatos.componentList[r].uuid;jatos.startComponent(i,t,e,o);break}},jatos.startLastComponent=function(t,e,o){var n=jatos.componentList.reverse().find((t=>t.active));jatos.startComponent(n.uuid,t,e,o)},jatos.joinGroup=function(t){return p=t||{},Y()},jatos.groupSession={},jatos.groupSession.get=function(e){return dt(jsonpointer.get(t,"/"+e))},jatos.groupSession.getAll=function(){return dt(jatos.groupSession.find(""))},jatos.groupSession.find=function(e){return dt(jsonpointer.get(t,e))},jatos.groupSession.test=function(e,o){return jsonpointer.get(t,e)===o},jatos.groupSession.defined=function(t){return!jatos.groupSession.test(t,void 0)},jatos.groupSession.add=function(t,e,o,n){return ot(z("add",t,e,null),o,n)},jatos.groupSession.set=function(t,e,o,n){return ot(z("add","/"+t,e,null),o,n)},jatos.groupSession.setAll=function(t,e,o){return jatos.groupSession.replace("",t,e,o)},jatos.groupSession.remove=function(t,e,o){return ot(z("remove",t,null,null),e,o)},jatos.groupSession.clear=function(t,e){return ot(z("remove","/",null,null),t,e)},jatos.groupSession.replace=function(t,e,o,n){return ot(z("replace",t,e,null),o,n)},jatos.groupSession.copy=function(t,e,o,n){return ot(z("copy",e,null,t),o,n)},jatos.groupSession.move=function(t,e,o,n){return ot(z("move",e,null,t),o,n)},jatos.setGroupFixed=function(t,e){if(!l||l.readyState!=l.OPEN)return it(e,"No open group channel"),lt();if(ct(O))return it(e,"Can fix group only once"),lt();O=jatos.jQuery.Deferred();var n={action:"FIXED"};try{l.send(JSON.stringify(n)),function(t,e,n){var a=setTimeout((()=>{st(n,"Timeout sending message"),t.reject("Timeout sending message")}),jatos.channelSendingTimeoutTime);o={cancel:()=>{clearTimeout(a),st(e,"success"),t.resolve("success")}},t.always((()=>{o=null}))}(O,t,e)}catch(t){it(e,t),O.reject()}return O.promise()},jatos.hasJoinedGroup=function(){return null!==jatos.groupResultId},jatos.hasOpenGroupChannel=function(){return l&&l.readyState==l.OPEN},jatos.isMaxActiveMemberReached=function(){return!(!jatos.batchProperties||null===jatos.batchProperties.maxActiveMembers)&&jatos.groupMembers.length>=jatos.batchProperties.maxActiveMembers},jatos.isMaxActiveMemberOpen=function(){return!(!jatos.batchProperties||null===jatos.batchProperties.maxActiveMembers)&&jatos.groupChannels.length>=jatos.batchProperties.maxActiveMembers},jatos.isGroupOpen=function(){return!(!l||l.readyState!=l.OPEN)&&jatos.groupMembers.length==jatos.groupChannels.length},jatos.sendGroupMsg=function(t){if(l&&l.readyState==l.OPEN){var e={};e.msg=t,l.send(JSON.stringify(e))}},jatos.sendGroupMsgTo=function(t,e){if(l&&l.readyState==l.OPEN){var o={};o.recipient=t,o.msg=e,l.send(JSON.stringify(o))}},jatos.reassignGroup=function(t,e){return ct(w)?(it(e,"Can't reassign group if not joined yet"),lt()):ct(x)?(it(e,"Can't reassign group during leaving"),lt()):ct(T)?(it(e,"Can't reassign group twice at the same time"),lt()):l&&l.readyState!=l.OPEN?(it(e,"Group channel not open"),lt()):(T=jatos.jQuery.Deferred(),jatos.jQuery.ajax({url:nt("../group/reassign"),processData:!1,type:"GET",timeout:jatos.httpTimeout,statusCode:{200:function(){st(t),T.resolve()},204:function(){st(e),T.reject()}},error:function(t){var o=rt(t);it(e,rt(t)),T.reject(o)}}),T.promise())},jatos.leaveGroup=function(t,e){return ct(w)?(it(e,"Can't leave group if not joined yet"),lt()):ct(T)?(it(e,"Can't leave group during reassigning"),lt()):ct(x)?(it(e,"Can leave only once"),lt()):(x=jatos.jQuery.Deferred(),jatos.jQuery.ajax({url:nt("../group/leave"),processData:!1,type:"GET",timeout:jatos.httpTimeout,success:function(e){clearInterval(r),st(t,e),x.resolve(e)},error:function(t){var o=rt(t);it(e,rt(t)),x.reject(o)}}).retry({times:jatos.httpRetry,timeout:jatos.httpRetryWait}),x.promise())},jatos.abortStudyAjax=function(t,e,o){if(!N)return lt();if(M)return it(o,"Can end/abort study only once"),lt();M=!0;var n=nt("../abort");void 0!==t&&(n=n+"?message="+t);var a={url:n,method:"GET",timeout:jatos.httpTimeout,retry:jatos.httpRetry,retryWait:jatos.httpRetryWait};jatos.showBeforeUnloadWarning(!1);var i=U(a,e,o);return setTimeout((function(){ct(E)&&ct(i)&&jatos.showOverlay(jatos.waitSendDataOverlayConfig)}),1e3),i.done((function(){window.removeEventListener("beforeunload",at,{capture:!0}),g.terminate(),v.terminate(),clearInterval(s),clearInterval(r)})),i.always(jatos.removeOverlay),i.promise()},jatos.abortStudy=function(t,e){if(void 0!==e&&!e)return jatos.abortStudyAjax(t);function o(){window.removeEventListener("beforeunload",at,{capture:!0});var e=nt("../abort");window.location.href=void 0===t?e:e+"?message="+t}M?it(null,"Can end/abort study only once"):(M=!0,ct(E)?(setTimeout(jatos.showOverlay,1e3,jatos.waitSendDataOverlayConfig),E.always(o)):o())},jatos.endStudyAjax=function(t,e,o,n,a){if(!N)return lt();var i,u,c,l,p;if("string"==typeof t||"object"==typeof t?(i=t,u=e,c=o,l=n,p=a):"boolean"==typeof t&&(u=t,c=e,l=o,p=n),M)return it(p,"Can end/abort study only once"),lt();M=!0,i&&jatos.appendResultData(i);var d=nt("../end");"boolean"==typeof u&&"string"==typeof c?d=d+"?"+jatos.jQuery.param({successful:u,message:c}):"boolean"==typeof u&&"string"!=typeof c?d=d+"?"+jatos.jQuery.param({successful:u}):"boolean"!=typeof u&&"string"==typeof c&&(d=d+"?"+jatos.jQuery.param({message:c}));var j={url:d,method:"GET",timeout:jatos.httpTimeout,retry:jatos.httpRetry,retryWait:jatos.httpRetryWait};jatos.showBeforeUnloadWarning(!1);var f=U(j,l,p);return setTimeout((function(){ct(E)&&ct(f)&&jatos.showOverlay(jatos.waitSendDataOverlayConfig)}),1e3),f.done((function(){window.removeEventListener("beforeunload",at,{capture:!0}),g.terminate(),v.terminate(),clearInterval(s),clearInterval(r)})),f.always(jatos.removeOverlay),f.promise()},jatos.endStudyAndRedirect=function(t,e,o,n,a,s){jatos.endStudyAjax(e,o,n,a,s).done((function(){window.location.href=t}))},jatos.endStudy=function(t,e,o,n){if(N){var a,s,r,i;if("string"==typeof t||"object"==typeof t?(a=t,s=e,r=o,i=n):"boolean"==typeof t&&(s=t,r=e,i=o),void 0!==i&&!i)return a?jatos.endStudyAjax(a,s,r):jatos.endStudyAjax(s,r);M?it(null,"Can end/abort study only once"):(M=!0,a&&jatos.appendResultData(a),ct(E)?(setTimeout(jatos.showOverlay,1e3,jatos.waitSendDataOverlayConfig),E.always(u)):u())}else it(null,"jatos.js not yet initialized");function u(){window.removeEventListener("beforeunload",at,{capture:!0});var t=nt("../end");"boolean"==typeof s&&"string"==typeof r?t=t+"?"+jatos.jQuery.param({successful:s,message:r}):"boolean"==typeof s&&"string"!=typeof r?t=t+"?"+jatos.jQuery.param({successful:s}):"boolean"!=typeof s&&"string"==typeof r&&(t=t+"?"+jatos.jQuery.param({message:r})),window.location.href=t}},jatos.getHttpLoopCounter=function(){return R},jatos.logError=function(t){jatos.log(t)},jatos.log=function(t){N&&U({url:nt("log"),method:"POST",data:t,contentType:"text/plain; charset=UTF-8",timeout:jatos.httpTimeout,retry:jatos.httpRetry,retryWait:jatos.httpRetryWait})},jatos.catchAndLogErrors=function(){window.addEventListener("error",(function(t){jatos.log("Via 'error' event in "+t.filename+":"+t.lineno+" - "+t.message)})),window.addEventListener("unhandledrejection",(function(t){jatos.log("Via 'unhandledrejection' event in "+t.filename+":"+t.lineno+" - "+t.message)}));var t=console.error,e=console.warn;console.error=function(e){jatos.log("Via console.error - "+e),t.apply(this,arguments)},console.warn=function(t){jatos.log("Via console.warn - "+t),e.apply(this,arguments)}},jatos.addJatosIds=function(t){return t.studyCode=jatos.studyCode,t.studyId=jatos.studyId,t.studyTitle=jatos.studyProperties.title,t.batchId=jatos.batchId,t.batchTitle=jatos.batchProperties.title,t.componentId=jatos.componentId,t.componentPos=jatos.componentPos,t.componentTitle=jatos.componentProperties.title,t.workerId=jatos.workerId,t.studyResultId=jatos.studyResultId,t.componentResultId=jatos.componentResultId,t.groupResultId=jatos.groupResultId,t.groupMemberId=jatos.groupMemberId,t},jatos.onLoad((function(){J&&!jatos.componentProperties.reloadable&&window.addEventListener("beforeunload",at,{capture:!0})}));var at=function(t){t.preventDefault(),t.returnValue="Are you sure you want to leave?"};function st(t,e,o){t&&"function"==typeof t&&t(e,o)}function rt(t){return"timeout"==t.statusText?"JATOS server not responding":t.responseText?t.statusText+": "+t.responseText:t.statusText+": Error during Ajax call to JATOS server."}function it(t,e){t?t(e):P&&P(e)}function ut(t,e,o,n,a){var s=setTimeout((function(){st(a,"Timeout sending message"),t.reject("Timeout sending message")}),jatos.channelSendingTimeoutTime);e[o]={cancel:function(){clearTimeout(s),st(n,"success"),t.resolve("success")},trigger:function(){clearTimeout(s),st(a,"Error sending message"),t.reject("Error sending message")}},t.always((function(){delete e[o]}))}function ct(t){return void 0!==t&&"pending"==t.state()}function lt(){var t=jatos.jQuery.Deferred();return t.reject(),t.promise()}function pt(t){return t<=0||t>jatos.componentList.length}function dt(t){var e;if(null===t||"object"!=typeof t)return t;if(t instanceof Array){e=[];for(var o=0,n=t.length;o<n;o++)e[o]=dt(t[o]);return e}if(t instanceof Object){for(var a in e={},t)t.hasOwnProperty(a)&&(e[a]=dt(t[a]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")}jatos.showBeforeUnloadWarning=function(t){J=t,t?window.addEventListener("beforeunload",at,{capture:!0}):window.removeEventListener("beforeunload",at,{capture:!0})},jatos.showOverlay=function(t){if(!t||"boolean"!=typeof t.show||t.show){var e="color: black;font-family: Sans-Serif;font-size: 30px;letter-spacing: 2px;opacity: 0.6;text-shadow: -1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;z-index: 9999;position: absolute;left: 50%;top: 50%;transform: translate(-50%, -50%);display: flex;align-items: center;justify-content: center;flex-direction: column;";t&&"string"==typeof t.style&&(e+=";"+t.style);var o=document.createElement("div");o.id="jatosOverlay",o.style.cssText=e;var n=t&&"string"==typeof t.text?t.text:"Please wait",a=document.createTextNode(n);if(o.appendChild(a),!t||"boolean"!=typeof t.showImg||t.showImg){var s=t&&"string"==typeof t.imgUrl?t.imgUrl:"jatos-publix/images/waiting.gif",r=document.createElement("img");r.src=s,r.style.marginTop="10px",o.appendChild(r)}jatos.removeOverlay(),document.body.appendChild(o)}},jatos.removeOverlay=function(){var t=document.getElementById("jatosOverlay");t&&t.remove()},jatos.addAbortButton=function(t){var e=t&&"string"==typeof t.text?t.text:"Cancel",o=!t||"boolean"!=typeof t.confirm||t.confirm,n=t&&"string"==typeof t.confirmText?t.confirmText:"Do you really want to cancel this study?",a=t&&"string"==typeof t.tooltip?t.tooltip:"Cancels this study and deletes all already submitted data",s=t&&"string"==typeof t.msg?t.msg:"Worker decided to abort",r="color:black;font-family:Sans-Serif;font-size:20px;letter-spacing:2px;position:fixed;margin:2em 0 0 2em;bottom:1em;right:1em;opacity:0.6;z-index:9999;cursor:pointer;text-shadow:-1px 0 white, 0 1px white, 1px 0 white, 0 -1px white;";t&&"string"==typeof t.style&&(r+=";"+t.style);var i=document.createTextNode(e),u=document.createElement("div");u.appendChild(i),u.style.cssText=r,u.setAttribute("title",a),u.addEventListener("click",(function(){o&&!window.confirm(n)||(t&&"function"==typeof t.action?t.action(s):jatos.abortStudy(s))})),document.body.appendChild(u)}}();
