/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * json-patch-duplex.js version: 1.1.8
 * (c) 2013 Joachim Wester
 * MIT license
 */
var jsonpatch;if(function(e){var t=function(e){if(p(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);t=[];for(var o in e)e.hasOwnProperty(o)&&t.push(o);return t};function n(e,o){switch(typeof e){case"undefined":case"boolean":case"string":case"number":return e===o;case"object":if(null===e)return null===o;if(p(e)){if(!p(o)||e.length!==o.length)return!1;for(var r=0,a=e.length;r<a;r++)if(!n(e[r],o[r]))return!1;return!0}var i=t(o).length;if(t(e).length!==i)return!1;for(r=0;r<i;r++)if(!n(e[r],o[r]))return!1;return!0;default:return!1}}var o={add:function(e,t){e[t]=this.value},remove:function(e,t){var n=e[t];return delete e[t],n},replace:function(e,t){var n=e[t];return e[t]=this.value,n},move:function(e,t,n){var o={op:"_get",path:this.path};d(n,[o]);var r=void 0===o.value?void 0:JSON.parse(JSON.stringify(o.value)),a={op:"_get",path:this.from};return d(n,[a]),d(n,[{op:"remove",path:this.from}]),d(n,[{op:"add",path:this.path,value:a.value}]),r},copy:function(e,t,n){var o={op:"_get",path:this.from};d(n,[o]),d(n,[{op:"add",path:this.path,value:o.value}])},test:function(e,t){return n(e[t],this.value)},_get:function(e,t){this.value=e[t]}},r={add:function(e,t){return e.splice(t,0,this.value),t},remove:function(e,t){return e.splice(t,1)[0]},replace:function(e,t){var n=e[t];return e[t]=this.value,n},move:o.move,copy:o.copy,test:o.test,_get:o._get},a={add:function(e){for(var t in a.remove.call(this,e),this.value)this.value.hasOwnProperty(t)&&(e[t]=this.value[t])},remove:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n],o.remove.call(this,e,n));return t},replace:function(e){var t=d(e,[{op:"remove",path:this.path}]);return d(e,[{op:"add",path:this.path,value:this.value}]),t[0]},move:o.move,copy:o.copy,test:function(e){return JSON.stringify(e)===JSON.stringify(this.value)},_get:function(e){this.value=e}};function i(e){return-1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}var p,s=[],u=function(e){this.observers=[],this.obj=e},c=function(e,t){this.callback=e,this.observer=t};function h(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function l(e){for(var t,n=0,o=s.length;n<o;n++)if(s[n].obj===e.object){t=s[n];break}v(t.value,e.object,e.patches,""),e.patches.length&&d(t.value,e.patches);var r=e.patches;return r.length>0&&(e.patches=[],e.callback&&e.callback(r)),r}function v(e,n,o,r){if(n!==e){"function"==typeof n.toJSON&&(n=n.toJSON());for(var a=t(n),s=t(e),u=!1,c=s.length-1;c>=0;c--){var l=e[d=s[c]];if(!n.hasOwnProperty(d)||void 0===n[d]&&void 0!==l&&!1===p(n))o.push({op:"remove",path:r+"/"+i(d)}),u=!0;else{var f=n[d];"object"==typeof l&&null!=l&&"object"==typeof f&&null!=f?v(l,f,o,r+"/"+i(d)):l!==f&&(!0,o.push({op:"replace",path:r+"/"+i(d),value:h(f)}))}}if(u||a.length!=s.length)for(c=0;c<a.length;c++){var d=a[c];e.hasOwnProperty(d)||void 0===n[d]||o.push({op:"add",path:r+"/"+i(d),value:h(n[d])})}}}function f(e){for(var t,n=0,o=e.length;n<o;){if(!((t=e.charCodeAt(n))>=48&&t<=57))return!1;n++}return!0}function d(e,t,n){for(var i,s,u=[],c=0,h=t.length;c<h;){i=t[c],c++;for(var l=(i.path||"").split("/"),v=e,d=1,w=l.length,O=void 0;;){if(s=l[d],n&&void 0===O&&(void 0===v[s]?O=l.slice(0,d).join("/"):d==w-1&&(O=i.path),void 0!==O&&this.validator(i,c-1,e,O)),d++,void 0===s&&d>=w){u.push(a[i.op].call(i,v,s,e));break}if(p(v)){if("-"===s)s=v.length;else{if(n&&!f(s))throw new m("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",c-1,i.path,i);s=parseInt(s,10)}if(d>=w){if(n&&"add"===i.op&&s>v.length)throw new m("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",c-1,i.path,i);u.push(r[i.op].call(i,v,s,e));break}}else if(s&&-1!=s.indexOf("~")&&(s=s.replace(/~1/g,"/").replace(/~0/g,"~")),d>=w){u.push(o[i.op].call(i,v,s,e));break}v=v[s]}}return u}e.unobserve=function(e,t){t.unobserve()},e.observe=function(e,t){var n,o=function(e){for(var t=0,n=s.length;t<n;t++)if(s[t].obj===e)return s[t]}(e);if(o?n=function(e,t){for(var n=0,o=e.observers.length;n<o;n++)if(e.observers[n].callback===t)return e.observers[n].observer}(o,t):(o=new u(e),s.push(o)),n)return n;if(n={},o.value=h(e),t){n.callback=t,n.next=null;var r=function(){l(n)},a=function(){clearTimeout(n.next),n.next=setTimeout(r)};"undefined"!=typeof window&&(window.addEventListener?(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a)):(document.documentElement.attachEvent("onmouseup",a),document.documentElement.attachEvent("onkeyup",a),document.documentElement.attachEvent("onmousedown",a),document.documentElement.attachEvent("onkeydown",a),document.documentElement.attachEvent("onchange",a)))}return n.patches=[],n.object=e,n.unobserve=function(){l(n),clearTimeout(n.next),function(e,t){for(var n=0,o=e.observers.length;n<o;n++)if(e.observers[n].observer===t)return void e.observers.splice(n,1)}(o,n),"undefined"!=typeof window&&(window.removeEventListener?(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a)):(document.documentElement.detachEvent("onmouseup",a),document.documentElement.detachEvent("onkeyup",a),document.documentElement.detachEvent("onmousedown",a),document.documentElement.detachEvent("onkeydown",a)))},o.observers.push(new c(t,n)),n},e.generate=l,p=Array.isArray?Array.isArray:function(e){return e.push&&"number"==typeof e.length},e.apply=d,e.compare=function(e,t){var n=[];return v(e,t,n,""),n};var m=function(e){function t(t,n,o,r,a){e.call(this,t),this.message=t,this.name=n,this.index=o,this.operation=r,this.tree=a}return function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function o(){this.constructor=e}e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}(t,e),t}(Error);function w(e){if(void 0===e)return!0;if("array"==typeof e||"object"==typeof e)for(var t in e)if(w(e[t]))return!0;return!1}e.JsonPatchError=m,e.validator=function(t,n,r,a){if("object"!=typeof t||null===t||p(t))throw new m("Operation is not an object","OPERATION_NOT_AN_OBJECT",n,t,r);if(!o[t.op])throw new m("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",n,t,r);if("string"!=typeof t.path)throw new m("Operation `path` property is not a string","OPERATION_PATH_INVALID",n,t,r);if(0!==t.path.indexOf("/")&&t.path.length>0)throw new m('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",n,t,r);if(("move"===t.op||"copy"===t.op)&&"string"!=typeof t.from)throw new m("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",n,t,r);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&void 0===t.value)throw new m("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",n,t,r);if(("add"===t.op||"replace"===t.op||"test"===t.op)&&w(t.value))throw new m("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",n,t,r);if(r)if("add"==t.op){var i=t.path.split("/").length,s=a.split("/").length;if(i!==s+1&&i!==s)throw new m("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",n,t,r)}else if("replace"===t.op||"remove"===t.op||"_get"===t.op){if(t.path!==a)throw new m("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",n,t,r)}else if("move"===t.op||"copy"===t.op){var u={op:"_get",path:t.from,value:void 0},c=e.validate([u],r);if(c&&"OPERATION_PATH_UNRESOLVABLE"===c.name)throw new m("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",n,t,r)}},e.validate=function(e,t){try{if(!p(e))throw new m("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)t=JSON.parse(JSON.stringify(t)),d.call(this,t,e,!0);else for(var n=0;n<e.length;n++)this.validator(e[n],n)}catch(e){if(e instanceof m)return e;throw e}}}(jsonpatch||(jsonpatch={})),void 0!==exports)exports.apply=jsonpatch.apply,exports.observe=jsonpatch.observe,exports.unobserve=jsonpatch.unobserve,exports.generate=jsonpatch.generate,exports.compare=jsonpatch.compare,exports.validate=jsonpatch.validate,exports.validator=jsonpatch.validator,exports.JsonPatchError=jsonpatch.JsonPatchError;else var exports={},isBrowser=!0;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=jsonpatch,isBrowser&&(exports=void 0);